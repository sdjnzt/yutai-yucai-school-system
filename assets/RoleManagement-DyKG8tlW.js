import{r as n,I as q,j as e,d as k,R as E,B as l,S as g,g as N,f as G}from"./index-BKa6_s3-.js";import{d as F}from"./dayjs.min-CX7emzkM.js";import{F as i}from"./index-Dy51_mCo.js";import{C as d,R,a}from"./row-CYwan9Jp.js";import{T as K}from"./index-DxCy7vEc.js";import{S as p}from"./index-D94na2-Y.js";import{R as I}from"./CheckCircleOutlined-BODazOcI.js";import{R as v}from"./ClockCircleOutlined-vw1tZwYu.js";import{I as u}from"./index-RlXwS1IG.js";import{R as V}from"./SearchOutlined-9Bh7V-wV.js";import{R as L}from"./PlusOutlined-DDPMmaXR.js";import{F as J,T as Q}from"./Table-mhucBYhg.js";import{M as A}from"./index-Bmfv7wRd.js";import{A as D}from"./index-BUEwUzq1.js";import{R as Z}from"./SafetyCertificateOutlined-DZ5ZW09k.js";import{T as H}from"./index-Bl9mn3fa.js";import{R as W,a as X}from"./EditOutlined-CBP3Yp8X.js";import{R as ee}from"./KeyOutlined-DXUxiQBT.js";import{P as te}from"./index-CvwNsgzJ.js";import{s as w}from"./index-BQEGLwMa.js";import{R as se}from"./BarsOutlined-DWqq05Mr.js";import{R as re}from"./FileTextOutlined-BurRnXhR.js";import"./EditOutlined-BMVt-i1G.js";import"./index-B7le64xc.js";import"./ClockCircleOutlined-CELcQ7Uv.js";import"./EyeOutlined-cX0j5ogd.js";import"./DeleteOutlined-DFutYCzo.js";var ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"};function C(){return C=Object.assign?Object.assign.bind():function(s){for(var c=1;c<arguments.length;c++){var m=arguments[c];for(var o in m)Object.prototype.hasOwnProperty.call(m,o)&&(s[o]=m[o])}return s},C.apply(this,arguments)}const oe=(s,c)=>n.createElement(q,C({},s,{ref:c,icon:ie})),ae=n.forwardRef(oe),{Title:ne,Text:ce}=K,{TextArea:le}=u,Oe=()=>{const[s]=i.useForm(),[c]=i.useForm(),[m,o]=n.useState(!1),[O,j]=n.useState(!1),[f,y]=n.useState(null),[T,b]=n.useState("create"),[S,M]=n.useState([]),$=()=>[{name:"超级管理员",code:"SUPER_ADMIN",description:"系统最高权限，可以管理所有功能",userCount:1},{name:"教务主任",code:"ACADEMIC_DIRECTOR",description:"负责教学管理、课程安排等教务工作",userCount:1},{name:"学生主任",code:"STUDENT_DIRECTOR",description:"负责学生管理、学生事务等工作",userCount:1},{name:"总务主任",code:"GENERAL_DIRECTOR",description:"负责学校总务、后勤等工作",userCount:1},{name:"教师",code:"TEACHER",description:"普通教师角色，可以查看教学相关信息",userCount:8},{name:"班主任",code:"CLASS_TEACHER",description:"班主任角色，可以管理班级相关事务",userCount:24}].map((r,x)=>({key:x+1,id:`R${String(x+1).padStart(4,"0")}`,...r,status:Math.random()>.1?"正常":"禁用",createTime:F("2025-07-25").subtract(Math.floor(Math.random()*365),"day").format("YYYY-MM-DD HH:mm:ss"),updateTime:F("2025-07-25").subtract(Math.floor(Math.random()*30),"day").format("YYYY-MM-DD HH:mm:ss")})),z=[{title:"系统管理",key:"system",icon:e.jsx(G,{}),children:[{title:"用户管理",key:"system:user",icon:e.jsx(E,{}),children:[{title:"查看用户",key:"system:user:view"},{title:"创建用户",key:"system:user:create"},{title:"编辑用户",key:"system:user:edit"},{title:"删除用户",key:"system:user:delete"}]},{title:"角色管理",key:"system:role",icon:e.jsx(k,{}),children:[{title:"查看角色",key:"system:role:view"},{title:"创建角色",key:"system:role:create"},{title:"编辑角色",key:"system:role:edit"},{title:"删除角色",key:"system:role:delete"}]}]},{title:"教务管理",key:"academic",icon:e.jsx(ae,{}),children:[{title:"课程管理",key:"academic:course",icon:e.jsx(se,{}),children:[{title:"查看课程",key:"academic:course:view"},{title:"创建课程",key:"academic:course:create"},{title:"编辑课程",key:"academic:course:edit"},{title:"删除课程",key:"academic:course:delete"}]},{title:"成绩管理",key:"academic:score",icon:e.jsx(re,{}),children:[{title:"查看成绩",key:"academic:score:view"},{title:"录入成绩",key:"academic:score:input"},{title:"编辑成绩",key:"academic:score:edit"},{title:"删除成绩",key:"academic:score:delete"}]}]}],h=n.useMemo(()=>{const t=$();return{total:t.length,active:t.filter(r=>r.status==="正常").length,disabled:t.filter(r=>r.status==="禁用").length,totalUsers:t.reduce((r,x)=>r+x.userCount,0)}},[]),B=t=>{console.log("Form values:",t),w.success(`${T==="create"?"创建":"更新"}角色成功`),o(!1),s.resetFields()},Y=()=>{console.log("Checked keys:",S),w.success("权限设置成功"),j(!1)},_=t=>{b("edit"),y(t),s.setFieldsValue(t),o(!0)},P=t=>{w.success("删除成功")},U=[{title:"角色名称",dataIndex:"name",key:"name",width:200,fixed:"left",render:(t,r)=>e.jsxs(g,{children:[e.jsx(k,{}),e.jsx(ce,{strong:!0,children:t}),e.jsx(H,{color:"blue",children:r.code})]})},{title:"角色描述",dataIndex:"description",key:"description",width:300},{title:"用户数量",dataIndex:"userCount",key:"userCount",width:120,render:t=>e.jsx(N,{count:t,style:{backgroundColor:"#52c41a"}})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(H,{color:t==="正常"?"success":"error",icon:t==="正常"?e.jsx(I,{}):e.jsx(v,{}),children:t})},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:180},{title:"操作",key:"action",width:250,fixed:"right",render:(t,r)=>e.jsxs(g,{children:[e.jsx(l,{type:"link",icon:e.jsx(W,{}),onClick:()=>_(r),children:"编辑"}),e.jsx(l,{type:"link",icon:e.jsx(ee,{}),onClick:()=>{y(r),M(["system:user:view","academic:course:view"]),j(!0)},children:"权限设置"}),e.jsx(te,{title:"确定要删除该角色吗？",onConfirm:()=>P(),okText:"确定",cancelText:"取消",children:e.jsx(l,{type:"link",danger:!0,icon:e.jsx(X,{}),children:"删除"})})]})}];return e.jsxs("div",{children:[e.jsxs(d,{children:[e.jsx(ne,{level:4,children:"角色管理"}),e.jsxs(R,{gutter:[16,16],style:{marginBottom:24},children:[e.jsx(a,{span:6,children:e.jsx(d,{children:e.jsx(p,{title:"角色总数",value:h.total,prefix:e.jsx(k,{style:{color:"#1890ff"}})})})}),e.jsx(a,{span:6,children:e.jsx(d,{children:e.jsx(p,{title:"正常角色",value:h.active,valueStyle:{color:"#52c41a"},prefix:e.jsx(I,{})})})}),e.jsx(a,{span:6,children:e.jsx(d,{children:e.jsx(p,{title:"禁用角色",value:h.disabled,valueStyle:{color:"#ff4d4f"},prefix:e.jsx(v,{})})})}),e.jsx(a,{span:6,children:e.jsx(d,{children:e.jsx(p,{title:"用户总数",value:h.totalUsers,prefix:e.jsx(E,{style:{color:"#722ed1"}}),suffix:"人"})})})]}),e.jsx(d,{style:{marginBottom:16},children:e.jsxs(R,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(a,{children:e.jsxs(i,{form:c,layout:"inline",children:[e.jsx(i.Item,{name:"keyword",children:e.jsx(u,{placeholder:"搜索角色名称/编码",prefix:e.jsx(V,{}),style:{width:200}})}),e.jsx(i.Item,{children:e.jsx(l,{type:"primary",icon:e.jsx(V,{}),children:"搜索"})})]})}),e.jsx(a,{children:e.jsx(l,{type:"primary",icon:e.jsx(L,{}),onClick:()=>{b("create"),y(null),s.resetFields(),o(!0)},children:"新建角色"})})]})}),e.jsx(J,{columns:U,dataSource:$(),pagination:{pageSize:10,showQuickJumper:!0,showSizeChanger:!0,showTotal:t=>`共 ${t} 条记录`},scroll:{x:1300}})]}),e.jsxs(A,{title:`${T==="create"?"新建":"编辑"}角色`,open:m,onOk:()=>s.submit(),onCancel:()=>{o(!1),s.resetFields()},width:600,children:[e.jsx(D,{message:"温馨提示",description:"请谨慎设置角色信息，角色创建后需要配置相应的权限。",type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs(i,{form:s,layout:"vertical",onFinish:B,children:[e.jsx(i.Item,{name:"name",label:"角色名称",rules:[{required:!0,message:"请输入角色名称"}],children:e.jsx(u,{placeholder:"请输入角色名称"})}),e.jsx(i.Item,{name:"code",label:"角色编码",rules:[{required:!0,message:"请输入角色编码"},{pattern:/^[A-Z_]{2,30}$/,message:"角色编码只能包含大写字母和下划线"}],children:e.jsx(u,{placeholder:"请输入角色编码，如：ADMIN、USER"})}),e.jsx(i.Item,{name:"description",label:"角色描述",rules:[{required:!0,message:"请输入角色描述"}],children:e.jsx(le,{rows:4,placeholder:"请输入角色描述"})}),e.jsx(i.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],initialValue:"正常",children:e.jsx(u.Group,{children:e.jsxs(R,{children:[e.jsx(a,{span:12,children:e.jsx(l,{type:s.getFieldValue("status")==="正常"?"primary":"default",icon:e.jsx(I,{}),onClick:()=>s.setFieldsValue({status:"正常"}),style:{width:"100%"},children:"正常"})}),e.jsx(a,{span:12,children:e.jsx(l,{type:s.getFieldValue("status")==="禁用"?"primary":"default",icon:e.jsx(v,{}),onClick:()=>s.setFieldsValue({status:"禁用"}),style:{width:"100%"},children:"禁用"})})]})})})]})]}),e.jsxs(A,{title:e.jsxs(g,{children:[e.jsx(Z,{}),e.jsxs("span",{children:["权限设置 - ",f==null?void 0:f.name]})]}),open:O,onOk:Y,onCancel:()=>j(!1),width:600,children:[e.jsx(D,{message:"温馨提示",description:"请谨慎设置角色权限，权限的变更将直接影响到该角色下所有用户的操作权限。",type:"warning",showIcon:!0,style:{marginBottom:24}}),e.jsx(Q,{checkable:!0,checkedKeys:S,onCheck:M,treeData:z,defaultExpandAll:!0,showIcon:!0})]})]})};export{Oe as default};
