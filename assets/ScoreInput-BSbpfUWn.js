import{r as h,I as Q,j as e,S as I,B as y,x as W,D as O,d as X,g as Y,T as Z}from"./index-GgCtaIGn.js";import{F as ee}from"./index-ChozH53D.js";import{C as w,R as G,a as p}from"./row-DkXY2Vpz.js";import{S as r}from"./index-BC_b-_9i.js";import{T as R}from"./index-SqXxCpUy.js";import{R as te}from"./SaveOutlined-DpAGI4yw.js";import{R as se,U as ne}from"./UploadOutlined-eRkgVvvY.js";import{R as E}from"./DownloadOutlined-CSN_M5gL.js";import{A as B}from"./index-Bf_beJbf.js";import{S as T}from"./index-B2tiHzLX.js";import{R as re}from"./TrophyOutlined-DIm1VlZk.js";import{T as ae}from"./index-CcFIDmFY.js";import{F as ie}from"./Table-BgKgGR4G.js";import{M as le}from"./index-DuzQfaQV.js";import{s as S}from"./index-C6tIceSr.js";import{T as oe}from"./index-DainJgL2.js";import"./DeleteOutlined-DFutYCzo.js";import"./DownloadOutlined-DTidZHln.js";import"./EyeOutlined-DiEmTHLP.js";import"./progress-BwjCmK0U.js";import"./EditOutlined-lBA9r8Oc.js";var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"};function F(){return F=Object.assign?Object.assign.bind():function(i){for(var m=1;m<arguments.length;m++){var d=arguments[m];for(var x in d)Object.prototype.hasOwnProperty.call(d,x)&&(i[x]=d[x])}return i},F.apply(this,arguments)}const de=(i,m)=>h.createElement(Q,F({},i,{ref:m,icon:ce})),pe=h.forwardRef(de),{Title:he}=ae,Be=()=>{const[i,m]=h.useState(null),[d,x]=h.useState(null),[f,L]=h.useState(null),[me]=ee.useForm(),[V,v]=h.useState(!1),$=[{id:"G1C1",name:"高一(1)班",type:"文科"},{id:"G1C2",name:"高一(2)班",type:"文科"},{id:"G1C3",name:"高一(3)班",type:"文科"},{id:"G1C4",name:"高一(4)班",type:"文科"},{id:"G1C5",name:"高一(5)班",type:"理科"},{id:"G1C6",name:"高一(6)班",type:"理科"},{id:"G1C7",name:"高一(7)班",type:"理科"},{id:"G1C8",name:"高一(8)班",type:"理科"}],N=[{id:"202507M",name:"2025年7月月考",type:"月考"},{id:"202507F",name:"2025年暑期补考",type:"补考"},{id:"202506F",name:"2025年期末考试",type:"期末"},{id:"202504M",name:"2025年4月月考",type:"月考"},{id:"202503M",name:"2025年3月月考",type:"月考"},{id:"202501F",name:"2025年期中考试",type:"期中"}],C=t=>{if(!t)return[];const a=$.find(o=>o.id===t),c=[];a.type;for(let o=1;o<=50;o++){const g=`${t}${String(o).padStart(2,"0")}`,M=60+Math.floor(Math.random()*30),b=Math.floor(Math.random()*20)-10,u=Math.min(Math.max(M+b,0),100);c.push({key:g,studentId:g,name:z(),score:u,status:u>=60?"pass":"fail",comment:k(u)})}return c},z=()=>{const t=["张","李","王","刘","陈","杨","赵","黄","周","吴"],a=["伟","芳","娜","秀英","敏","静","丽","强","磊","军"];return t[Math.floor(Math.random()*t.length)]+a[Math.floor(Math.random()*a.length)]},k=t=>t>=90?"优秀，继续保持":t>=80?"良好，仍有提升空间":t>=70?"中等，需要加强练习":t>=60?"及格，但需要更多努力":"需要补习，建议参加辅导",[n,j]=h.useState([]),l=h.useMemo(()=>{if(!n.length)return null;const t=n.length,a=n.filter(s=>s.score>=60).length,c=n.filter(s=>s.score>=90).length,o=n.reduce((s,K)=>s+K.score,0),g=Math.round(o/t),M=Math.max(...n.map(s=>s.score)),b=Math.min(...n.map(s=>s.score)),u={"90-100":n.filter(s=>s.score>=90).length,"80-89":n.filter(s=>s.score>=80&&s.score<90).length,"70-79":n.filter(s=>s.score>=70&&s.score<80).length,"60-69":n.filter(s=>s.score>=60&&s.score<70).length,"0-59":n.filter(s=>s.score<60).length};return{total:t,passed:a,excellent:c,averageScore:g,maxScore:M,minScore:b,passRate:Math.round(a/t*100),excellentRate:Math.round(c/t*100),distribution:u}},[n]),D=t=>{m(t),t&&d&&f&&j(C(t))},H=t=>{x(t),i&&t&&f&&j(C(i))},A=t=>{L(t),i&&d&&t&&j(C(i))},U=(t,a)=>{const c=n.map(o=>o.key===a.key?{...o,score:t,status:t>=60?"pass":"fail",comment:k(t)}:o);j(c)},P=()=>{S.success("成绩保存成功")},_=t=>{t.file.status==="done"?(S.success(`${t.file.name} 文件上传成功`),v(!1)):t.file.status==="error"&&S.error(`${t.file.name} 文件上传失败`)},q=()=>{S.success("成绩导出成功")},J=[{title:"学号",dataIndex:"studentId",key:"studentId",width:120,fixed:"left"},{title:"姓名",dataIndex:"name",key:"name",width:100,fixed:"left"},{title:"成绩",dataIndex:"score",key:"score",width:150,render:(t,a)=>e.jsx(oe,{min:0,max:100,value:t,onChange:c=>U(c,a),style:{width:"100%"}})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(Y,{status:t==="pass"?"success":"error",text:t==="pass"?"及格":"不及格"})},{title:"评语",dataIndex:"comment",key:"comment",ellipsis:{showTitle:!1},render:t=>e.jsx(Z,{placement:"topLeft",title:t,children:t})}];return e.jsxs("div",{children:[e.jsx(w,{style:{marginBottom:16},children:e.jsxs(G,{gutter:16,align:"middle",children:[e.jsx(p,{span:6,children:e.jsx(r,{placeholder:"请选择班级",style:{width:"100%"},onChange:D,value:i,children:$.map(t=>e.jsxs(r.Option,{value:t.id,children:[t.name,e.jsx(R,{color:t.type==="文科"?"blue":"green",style:{marginLeft:8},children:t.type})]},t.id))})}),e.jsx(p,{span:6,children:e.jsxs(r,{placeholder:"请选择学科",style:{width:"100%"},onChange:H,value:d,children:[e.jsxs(r.OptGroup,{label:"文科",children:[e.jsx(r.Option,{value:"语文",children:"语文"}),e.jsx(r.Option,{value:"英语",children:"英语"}),e.jsx(r.Option,{value:"政治",children:"政治"}),e.jsx(r.Option,{value:"历史",children:"历史"}),e.jsx(r.Option,{value:"地理",children:"地理"})]}),e.jsxs(r.OptGroup,{label:"理科",children:[e.jsx(r.Option,{value:"数学",children:"数学"}),e.jsx(r.Option,{value:"物理",children:"物理"}),e.jsx(r.Option,{value:"化学",children:"化学"}),e.jsx(r.Option,{value:"生物",children:"生物"})]})]})}),e.jsx(p,{span:6,children:e.jsx(r,{placeholder:"请选择考试",style:{width:"100%"},onChange:A,value:f,children:N.map(t=>e.jsxs(r.Option,{value:t.id,children:[t.name,e.jsx(R,{color:t.type==="期末"?"red":t.type==="期中"?"orange":t.type==="月考"?"blue":"purple",style:{marginLeft:8},children:t.type})]},t.id))})}),e.jsx(p,{span:6,style:{textAlign:"right"},children:e.jsxs(I,{children:[e.jsx(y,{type:"primary",icon:e.jsx(te,{}),onClick:P,disabled:!n.length,children:"保存"}),e.jsx(y,{icon:e.jsx(se,{}),onClick:()=>v(!0),children:"导入"}),e.jsx(y,{icon:e.jsx(E,{}),onClick:q,disabled:!n.length,children:"导出"})]})})]})}),!i||!d||!f?e.jsx(B,{message:"请选择班级、学科和考试",description:"请先完整选择以上信息来录入或查看成绩",type:"info",showIcon:!0,style:{marginBottom:16}}):e.jsxs(e.Fragment,{children:[l&&e.jsx(w,{style:{marginBottom:16},children:e.jsxs(G,{gutter:16,children:[e.jsxs(p,{span:6,children:[e.jsx(T,{title:"平均分",value:l.averageScore,suffix:"分",prefix:e.jsx(W,{})}),e.jsx(O,{style:{margin:"12px 0"}}),e.jsxs(I,{children:[e.jsxs("span",{children:["最高分：",l.maxScore]}),e.jsxs("span",{children:["最低分：",l.minScore]})]})]}),e.jsxs(p,{span:6,children:[e.jsx(T,{title:"及格率",value:l.passRate,suffix:"%",prefix:e.jsx(X,{})}),e.jsx(O,{style:{margin:"12px 0"}}),e.jsxs("div",{children:["及格人数：",l.passed,"/",l.total]})]}),e.jsxs(p,{span:6,children:[e.jsx(T,{title:"优秀率",value:l.excellentRate,suffix:"%",prefix:e.jsx(re,{})}),e.jsx(O,{style:{margin:"12px 0"}}),e.jsxs("div",{children:["优秀人数：",l.excellent,"/",l.total]})]}),e.jsxs(p,{span:6,children:[e.jsx(he,{level:5,children:"分数段分布"}),e.jsx(I,{direction:"vertical",style:{width:"100%"},children:Object.entries(l.distribution).map(([t,a])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(R,{color:t==="90-100"?"red":t==="80-89"?"orange":t==="70-79"?"green":t==="60-69"?"blue":"gray",children:[t,"分"]}),e.jsxs("span",{children:[a,"人"]})]},t))})]})]})}),e.jsx(w,{children:e.jsx(ie,{columns:J,dataSource:n,pagination:!1,scroll:{x:800,y:500},bordered:!0})})]}),e.jsxs(le,{title:"导入成绩",open:V,onCancel:()=>v(!1),footer:null,children:[e.jsx(B,{message:"导入说明",description:e.jsxs("ul",{children:[e.jsx("li",{children:"请使用标准模板导入成绩"}),e.jsx("li",{children:"支持 .xlsx, .xls 格式的文件"}),e.jsx("li",{children:"请确保表格中学号与系统中的学号一致"}),e.jsx("li",{children:"成绩请填写0-100的整数"})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(ne.Dragger,{name:"file",action:"/api/score/import",onChange:_,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(pe,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽文件到此区域上传"}),e.jsx("p",{className:"ant-upload-hint",children:"单次只能上传一个文件"})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(y,{type:"link",icon:e.jsx(E,{}),children:"下载导入模板"})})]})]})};export{Be as default};
